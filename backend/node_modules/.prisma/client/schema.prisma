generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Poliklinik {
  id         Int      @id @default(autoincrement())
  name       String
  queue_code String   @unique
  doctors    Doctor[]
}

model Doctor {
  id            Int        @id @default(autoincrement())
  name          String
  specialist    String
  photo_url     String?
  poliklinik_id Int
  poliklinik    Poliklinik @relation(fields: [poliklinik_id], references: [id])
  DailyQuota    DailyQuota[]
}

model DailyQuota {
  id            Int         @id @default(autoincrement())
  doctor_id     Int
  doctor        Doctor      @relation(fields: [doctor_id], references: [id])
  date          DateTime
  max_quota     Int
  current_count Int         @default(0)
  status        String      @default("OPEN") // OPEN, CLOSED, FULL, BREAK
  queues        Queue[]

  @@unique([doctor_id, date])
}

model Queue {
  id             Int         @id @default(autoincrement())
  daily_quota_id Int
  daily_quota    DailyQuota  @relation(fields: [daily_quota_id], references: [id])
  queue_number   Int
  queue_code     String
  status         String      @default("WAITING") // WAITING, CALLED, SERVED, SKIPPED
  created_at     DateTime    @default(now())
}

model User {
  id       Int    @id @default(autoincrement())
  username String @unique
  password String
  role     String // ADMIN, STAFF
}

model Counter {
  id        Int      @id @default(autoincrement())
  name      String   @unique
  status    String   @default("CLOSED") // OPEN, CLOSED, BUSY
  createdAt DateTime @default(now())
}
